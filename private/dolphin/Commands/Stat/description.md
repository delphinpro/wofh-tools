# Обновление миров

0. Обновление данных мира начинается с создания объекта данных.
0. Объект данных загружает новые данные из json файла. Данные записываются в поле `raw`.
0. Проверяется структура данных (не реализовано). 
0. Далее фиксируется состояние обновления мира и открывается транзакция.
0. Выполняется нормализация данных. Нормализованные данные сохраняются в полях `towns`, `accounts`, `countries`.
    0. При нормализации городов, сразу фильтруются города без аккаунтов (варварские) и с нулевым населением
0. Подсчитываются суммы параметров (население, города, аккаунты, рейтинги)
0. Выполняется фильтрация
    0. Фильтрация аккаунтов с нулевым населением
    0. Фильтрация стран с нулевым населением
0. Читаются предыдущие данные из базы.

## Объект данных `DataStorage`

### Конструктор

В конструкторе объекта данных ничего не происходит, кроме инициализации внутренних полей пустыми значениями.

### Загрузка новых данных из файла

Примитивный метод.
Загрузка и декодирование данных из json файла.
Инициализация поля `time` объектом `Carbon` со временем состояния данных.

### Нормализация данных

Заполняются отсутствующие в исходных данных элементы массива для внутреннего использования.

### Запись первичных данных

### Чтение предыдущих данных

После считывания данных делается цикличный проход.
